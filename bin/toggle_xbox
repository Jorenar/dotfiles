#!/usr/bin/env sh

fullId="$(lsusb | awk '/Xbox.*Controller/ {print $6}')"
for id in $fullId; do
    vendorId="${id%%:*}"
    productId="${id##*:}"

    dev="$(grep -l "$productId" /sys/bus/usb/devices/*/idProduct)"

    dev=${dev%/*}
    if grep -q "$vendorId" "$dev/idVendor"; then
        auth="$dev/authorized"
        [ "$(cat $auth)" = 1 ] && action=0 || action=1
        echo "$action" | sudo tee "$auth" > /dev/null
        if [ $action = 0 ]; then
            notify-send "Xbox Controller disabled"
        else
            notify-send "Xbox Controller enabled"
        fi
    fi
done
