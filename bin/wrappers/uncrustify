#!/usr/bin/env sh

. $XDG_LIB_DIR/shell/wrapper_exec.sh

if [ "$1" = "--l" ]; then
    lang="-l $2"
    shift 2

    if [ -n "$UNCRUSTIFY_CONFIG" ]; then
        dir="$(dirname $UNCRUSTIFY_CONFIG)"
    else
        dir="$HOME/.uncrustify"
    fi

    cfg="$TMPDIR/uncrustify.cfg"

    mkfifo "$cfg"

    for f in $@; do
        cfgs="$cfgs $dir/$f"
    done

    cat "${UNCRUSTIFY_CONFIG:-"$dir/default"}" $cfgs > "$cfg" &

    wrapper_exec -q --no-backup $lang -c "$cfg"

    rm $cfg

else
    wrapper_exec "$@"
fi
